<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bartelt Angus • Lot Videos | Venture Ag Marketing</title>
  <meta name="description" content="Bartelt Angus lot videos with catalog images." />

  <!-- Speed: warm connections -->
  <link rel="preconnect" href="https://player.vimeo.com">
  <link rel="preconnect" href="https://i.vimeocdn.com">
  <link rel="preconnect" href="https://vumbnail.com">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --vam-bg:#0B0B0B;
      --vam-text:#F2F2F2;
      --vam-muted:rgba(242,242,242,.72);
      --vam-gold:#C9A45C;
      --vam-gold-dark:#9F7C3B;
      --vam-shadow:0 18px 54px rgba(0,0,0,.22);
    }
    body{ font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:#F7F7F7; color:#111; }

    /* Top Bar */
    .topbar{
      background: rgba(11,11,11,.94);
      color: var(--vam-text);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,.08);
      position: sticky; top: 0; z-index: 10;
    }
    .topbar .title{
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      margin: 0;
      font-size: .95rem;
    }

    .btn-ghost{
      border: 1px solid rgba(255,255,255,.22);
      color: #fff;
      background: rgba(255,255,255,.06);
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      border-radius: 14px;
      padding: 10px 14px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.10); color:#fff; }

    /* Player Shell */
    .player-shell{
      border-radius: 18px;
      overflow: hidden;
      background: #0b0b0b;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--vam-shadow);
    }
    .player-head{
      padding: 14px 16px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(135deg, #0b0b0b 0%, #111 55%, #0b0b0b 100%);
      color: var(--vam-text);
    }

    .player-title{
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      margin: 0;
      font-size: 1.05rem;
    }
    .player-sub{
      margin: 2px 0 0;
      color: rgba(242,242,242,.78);
      font-size: .88rem;
      font-weight: 800;
      letter-spacing: .04em;
      text-transform: uppercase;
    }

    .player-frame{ width:100%; height:100%; border:0; background:#000; }

    /* Desktop: slightly shorter video */
    .video-ratio{
      background:#000;
      border-bottom: 1px solid rgba(255,255,255,.10);
      position: relative;
    }
    @media (min-width: 992px){
      .video-ratio.ratio-16x9{ --bs-aspect-ratio: 44%; }
    }

    /* Hard lock clicks on Vimeo iframe (no overlays/unmute UI) */
    .video-ratio iframe{ pointer-events: none; }

    /* ✅ Loading overlay (thumb) */
    .vimeo-lite{
      position:absolute;
      inset:0;
      background:#000;
      display:none;
      align-items:center;
      justify-content:center;
      user-select:none;
      z-index: 2;
    }
    .vimeo-lite img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      opacity:.98;
    }
    .vimeo-lite .play-btn{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
    }
    .vimeo-lite .play-btn::before{
      content:"";
      width:64px;
      height:64px;
      border-radius:999px;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      box-shadow:0 12px 28px rgba(0,0,0,.35);
    }
    .vimeo-lite .play-btn::after{
      content:"";
      position:absolute;
      width:0;height:0;
      border-left:18px solid #fff;
      border-top:12px solid transparent;
      border-bottom:12px solid transparent;
      transform: translateX(3px);
    }
    .vimeo-lite .tiny{
      position:absolute;
      bottom:10px;
      left:10px;
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:.72rem;
      color:rgba(255,255,255,.72);
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      padding:6px 10px;
      border-radius:999px;
      backdrop-filter: blur(6px);
    }

    /* Player actions */
    .player-actions{
      padding: 12px 14px;
      background: #0b0b0b;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .btn-nav{
      border-radius: 14px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      display:inline-flex;
      align-items:center;
      gap:10px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: #fff;
      white-space: nowrap;
    }
    .btn-nav:hover{ background: rgba(255,255,255,.10); }
    .btn-nav:disabled{ opacity: .45; cursor: not-allowed; }

    .lot-counter{
      color: rgba(242,242,242,.75);
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      font-size: .82rem;
      white-space:nowrap;
    }

    /* Custom scrub controls (our UI only) */
    .scrub-area{
      width: 100%;
      padding: 10px 14px 12px;
      background: #0b0b0b;
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .scrub-row{ display:flex; align-items:center; gap:10px; }
    .scrub{ width: 100%; accent-color: var(--vam-gold); height: 6px; cursor: pointer; }
    .timecode{
      color: rgba(242,242,242,.70);
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: .78rem;
      white-space:nowrap;
      min-width: 110px;
      text-align:right;
    }

    /* Sale info strip */
    .sale-strip{
      background: linear-gradient(135deg, rgba(201,164,92,.16), rgba(255,255,255,.04));
      border-top: 1px solid rgba(255,255,255,.10);
      padding: 12px 14px;
      color: rgba(242,242,242,.92);
    }
    .sale-strip .label{
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      font-size: .78rem;
      color: rgba(242,242,242,.80);
      margin-bottom: 8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .sale-row{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:12px 18px;
      justify-content:space-between;
    }
    .sale-mini{
      display:flex;
      flex-wrap:wrap;
      gap:10px 16px;
      align-items:center;
      color: rgba(242,242,242,.88);
      font-weight: 800;
    }
    .sale-mini span{
      display:inline-flex;
      gap:8px;
      align-items:center;
      color: rgba(242,242,242,.84);
      font-weight: 800;
      letter-spacing: .02em;
    }
    .sale-mini i{ color: var(--vam-gold); }
    .sale-actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:flex-start;
    }

    .btn-gold{
      background: var(--vam-gold);
      border: 1px solid var(--vam-gold);
      color:#0B0B0B;
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      border-radius: 14px;
      padding: 10px 14px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space: nowrap;
    }
    .btn-gold:hover{ background: var(--vam-gold-dark); border-color: var(--vam-gold-dark); color:#0B0B0B; }

    .btn-light-outline{
      border-radius: 14px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:#fff;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space: nowrap;
    }
    .btn-light-outline:hover{ background: rgba(255,255,255,.10); color:#fff; }

    /* Catalog panel */
    .catalog-panel{
      height:100%;
      background:#0b0b0b;
      border-left: 1px solid rgba(255,255,255,.10);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .catalog-title{
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      font-size: .78rem;
      color: rgba(242,242,242,.82);
      display:flex;
      align-items:center;
      gap:8px;
      margin:0;
    }

    .catalog-frame{
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 16px 44px rgba(0,0,0,.45);
      background:#fff;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor: zoom-in;
    }
    .catalog-img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
      display:block;
      background:#fff;
    }

    .tap-hint{
      color: rgba(242,242,242,.70);
      font-size: .86rem;
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      margin:0;
    }

    /* Controls */
    .controls{
      background: rgba(255,255,255,.80);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 18px;
      box-shadow: 0 10px 26px rgba(0,0,0,.08);
      padding: 14px;
    }
    .search{
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      padding: 12px 14px;
    }
    .count{
      color: rgba(0,0,0,.62);
      font-weight: 800;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: .82rem;
    }

    /* Lot Cards */
    .lot-card{
      border-radius: 18px;
      overflow:hidden;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 14px 36px rgba(0,0,0,.12);
      height:100%;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .lot-card:hover{ transform: translateY(-2px); box-shadow: 0 18px 44px rgba(0,0,0,.18); }

    .lot-top{
      background:
        radial-gradient(circle at 25% 20%, rgba(201,164,92,.26), rgba(0,0,0,0) 55%),
        linear-gradient(135deg, #111 0%, #0b0b0b 60%, #151515 100%);
      color: var(--vam-text);
      padding: 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-height: 92px;
    }
    .lot-left{ display:flex; align-items:center; gap:12px; }
    .lot-num{ font-weight:900; letter-spacing:.10em; text-transform:uppercase; font-size:.80rem; color: rgba(242,242,242,.82); }
    .lot-big{ font-weight:900; letter-spacing:.06em; text-transform:uppercase; font-size: 1.9rem; line-height:1; margin:5px 0 0; color: var(--vam-gold); }

    .thumb{
      width: 96px; height: 96px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
      cursor: zoom-in;
    }
    .thumb img{ width:100%; height:100%; object-fit: cover; display:block; }

    .play{
      width: 42px; height: 42px;
      border-radius: 14px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      display:flex; align-items:center; justify-content:center;
      flex: 0 0 auto;
    }
    .play i{ color: var(--vam-gold); }

    .lot-body{ padding: 12px 14px 14px; }
    .lot-title{ font-weight: 900; margin:0 0 4px; }
    .lot-meta{ color: rgba(0,0,0,.62); margin:0; font-size:.95rem; }

    .active-lot{
      outline: 3px solid rgba(201,164,92,.55);
      outline-offset: 2px;
    }

    @media (max-width: 991.98px){
      .thumb{ width: 110px; height: 110px; }
      .catalog-panel{ border-left:none; border-top: 1px solid rgba(255,255,255,.10); }
      .sale-row{ justify-content:flex-start; }
      .sale-actions{ justify-content:flex-start; }
      .timecode{ min-width: 95px; }
      .catalog-frame{ aspect-ratio: 16 / 9; }
    }

    /* =========================
       FULLSCREEN IMAGE VIEWER
       ========================= */
    .img-modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.92);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .img-modal.show{ display:flex; }

    .img-modal-close{
      position: absolute;
      top: 14px;
      right: 14px;
      width: 44px;
      height: 44px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 18px;
      cursor: pointer;
      z-index: 3;
    }
    .img-modal-close:hover{ background: rgba(255,255,255,.12); }

    .img-modal-hint{
      position: absolute;
      left: 14px;
      top: 14px;
      color: rgba(255,255,255,.75);
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-size: .78rem;
      z-index: 3;
    }

    .zoom-stage{
      position: absolute;
      inset: 0;
      overflow: hidden;
      touch-action: pan-x pan-y; /* pinch works; no double-tap zoom behavior */
      cursor: default;
      z-index: 2;
    }
    .zoom-stage.dragging{ cursor: grabbing; }

    .zoom-img{
      position: absolute;
      top: 50%;
      left: 50%;
      transform-origin: 0 0;
      user-select: none;
      -webkit-user-drag: none;
      max-width: none;
      width: auto;
      height: auto;
      will-change: transform;
      opacity: 0;
      transition: opacity .08s linear;
    }
  </style>
</head>
<script>
(function(){
  const BASE = "https://script.google.com/macros/s/AKfycbxsQw8At8_IMxc4TrcdfavEkFeYMaTAzBSDlLdq51gb88J-VUxNEXxam_DJwBLS4LNLqA/exec";

  const KEY = "vam_sid";
  let sid = localStorage.getItem(KEY);
  if (!sid) {
    sid = Date.now() + "-" + Math.random().toString(16).slice(2);
    localStorage.setItem(KEY, sid);
  }

  function ping(params){
    const q = new URLSearchParams({
      type: "analytics",
      sid: sid,
      page: location.href,
      ua: navigator.userAgent,
      t: Date.now().toString(), // ✅ cache buster (required)
      ...params
    });
    (new Image()).src = BASE + "?" + q.toString();
  }

  // page view
  ping({ event: "page_view" });

  // clicks
  document.addEventListener("click", (ev) => {
    const el = ev.target.closest("a,button,[role='button']");
    if (!el) return;

    const label = (
      el.getAttribute("data-track") ||
      el.innerText ||
      el.getAttribute("aria-label") ||
      el.id ||
      "unknown"
    ).trim().slice(0, 120);

    const href = el.href || el.getAttribute("href") || "";

    ping({ event: "click", label, href });
  }, true);
})();
</script>

<body>

  <!-- Sticky Top Bar -->
  <div class="topbar">
    <div class="container py-3 d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <p class="title mb-1">Bartelt Angus • Lot Videos</p>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <a class="btn-ghost" href="sale-bartelt.html"><i class="fa-solid fa-arrow-left"></i> Sale Info</a>
        <a class="btn-ghost" href="./index.html#sales"><i class="fa-solid fa-house"></i> Home</a>
      </div>
    </div>
  </div>

  <main class="py-5">
    <div class="container">

      <!-- BIG PLAYER -->
      <div class="player-shell mb-4">
        <div class="player-head">
          <div>
            <p class="player-title mb-1" id="playerTitle">Loading…</p>
            <p class="player-sub" id="playerSub"></p>
          </div>
        </div>

        <div class="row g-0">
          <!-- VIDEO -->
          <div class="col-12 col-lg-8 order-1 order-lg-1">
            <div class="ratio ratio-16x9 video-ratio">
              <iframe id="playerFrame" class="player-frame"
                src=""
                title="Lot Video"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen></iframe>

              <!-- Loading overlay -->
              <div id="vimeoLoading" class="vimeo-lite">
                <img id="vimeoLoadingImg" src="" alt="Loading thumbnail" loading="lazy" decoding="async">
                <div class="play-btn"></div>
                <div class="tiny">Loading…</div>
              </div>
            </div>

            <div class="scrub-area">
              <div class="scrub-row">
                <input id="scrub" class="scrub" type="range" min="0" max="1000" value="0" step="1" aria-label="Scrub">
                <div class="timecode" id="timecode">0:00 / 0:00</div>
              </div>
            </div>

            <div class="player-actions">
              <button id="prevBtn" class="btn-nav" type="button">
                <i class="fa-solid fa-arrow-left"></i> Prev
              </button>

              <div class="lot-counter" id="lotCounter">— / —</div>

              <button id="nextBtn" class="btn-nav" type="button">
                Next <i class="fa-solid fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- CATALOG -->
          <div class="col-12 col-lg-4 order-2 order-lg-2">
            <div class="catalog-panel" id="catalogWrap" style="display:none;">
              <p class="catalog-title"><i class="fa-solid fa-image"></i> Catalog image</p>
              <div class="catalog-frame" id="catalogFrame">
                <img id="catalogImg" class="catalog-img" src="" alt="Catalog image">
              </div>
              <p class="tap-hint"><i class="fa-solid fa-magnifying-glass-plus"></i> Tap to enlarge • pinch to zoom</p>
            </div>
          </div>

          <!-- SALE STRIP -->
          <div class="col-12 col-lg-8 order-3 order-lg-3">
            <div class="sale-strip">
              <div class="label"><i class="fa-solid fa-circle-info"></i> Sale</div>

              <div class="sale-row">
                <div class="sale-mini">
                  <span><i class="fa-solid fa-calendar-days"></i> March 4 • Platte, SD</span>
                  <span><i class="fa-solid fa-location-dot"></i> Platte Livestock Market</span>
                  <span><i class="fa-solid fa-phone"></i> 605-999-0147</span>
                </div>

                <div class="sale-actions">
                  <a class="btn-gold" target="_blank" rel="noopener"
                     href="https://www.google.com/maps/search/?api=1&query=Platte%20Livestock%20Market%2C%2036580%20SD-44%2C%20Platte%2C%20SD%2057369">
                    <i class="fa-solid fa-map-location-dot"></i> Directions
                  </a>

                  <a class="btn-light-outline" target="_blank" rel="noopener"
                     href="http://www.plattelivestockmarket.com">
                    <i class="fa-solid fa-globe"></i> Venue Website
                  </a>

                  <a class="btn-light-outline" target="_blank" rel="noopener"
                     href="https://www.facebook.com/barteltangus">
                    <i class="fa-brands fa-facebook-f"></i> Facebook
                  </a>

                  <!-- ✅ Call button removed -->
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Controls -->
      <div class="controls mb-4">
        <div class="row g-3 align-items-center">
          <div class="col-12 col-lg-6">
            <input id="searchInput" class="form-control search"
              placeholder="Search lots (ex: 11, bull, heifer)">
          </div>
          <div class="col-12 col-lg-6 d-flex justify-content-lg-end justify-content-start">
            <div class="count" id="countText">0 lots</div>
          </div>
        </div>
      </div>

      <!-- Grid -->
      <div class="row g-4" id="grid"></div>

    </div>
  </main>

  <!-- FULLSCREEN IMAGE MODAL -->
  <div id="imgModal" class="img-modal" aria-hidden="true">
    <div class="img-modal-hint">Pinch to zoom • drag to move • wheel zoom</div>

    <button id="imgModalClose" class="img-modal-close" type="button" aria-label="Close">
      <i class="fa-solid fa-xmark"></i>
    </button>

    <div id="stage" class="zoom-stage" role="dialog" aria-label="Catalog image viewer">
      <img id="zoomImg" class="zoom-img" src="" alt="Zoomed catalog image">
    </div>
  </div>

  <!-- Vimeo Player API (required for scrub control) -->
  <script src="https://player.vimeo.com/api/player.js"></script>

  <script>
    // =========================
    // VIMEO HELPERS
    // =========================
    function extractVimeoId(input){
      if(!input) return "";
      const s = String(input).trim();
      if(!s) return "";
      if(/^\d+$/.test(s)) return s;

      try{
        const url = new URL(s);
        const parts = url.pathname.split("/").filter(Boolean);
        for(let i = parts.length - 1; i >= 0; i--){
          if(/^\d+$/.test(parts[i])) return parts[i];
        }
      }catch(e){
        const m = s.match(/(\d{6,})/);
        return m ? m[1] : "";
      }
      return "";
    }

    function vimeoSrc(fromUrlOrId){
      const id = extractVimeoId(fromUrlOrId);
      if(!id) return "";
      return `https://player.vimeo.com/video/${id}?background=1&autoplay=1&muted=1&loop=1&autopause=0&playsinline=1&title=0&byline=0&portrait=0&dnt=1`;
    }

    function vimeoThumbUrl(fromUrlOrId){
      const id = extractVimeoId(fromUrlOrId);
      if(!id) return "";
      return `https://vumbnail.com/${id}.jpg`;
    }

    function fmtTime(sec){
      if(!isFinite(sec) || sec < 0) sec = 0;
      sec = Math.floor(sec);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}:${String(s).padStart(2,"0")}`;
    }

    // =========================
    // LOTS
    // =========================
    const lots = [
      { lot:"1",   name:"Bartelt Chief 551",        sire:"Connealy Craftsman",           meta:"Bull",       vimeo:"https://vimeo.com/1162334058", catalogImg:"assets/img/Catalog/Lot 1.JPG" },
      { lot:"2",   name:"Bartelt Bulldozer 557",    sire:"Sitz Barricade 632F",          meta:"Bull",       vimeo:"https://vimeo.com/1162333759", catalogImg:"assets/img/Catalog/Lot 2.JPG" },
      { lot:"3",   name:"Bartelt All The Above 550",sire:"Stellpflug Hoffman RiseAbove", meta:"Bull",       vimeo:"https://vimeo.com/1162333807", catalogImg:"assets/img/Catalog/Lot 3.JPG" },
      { lot:"4",   name:"Bartelt Rise Above 554",   sire:"Stellpflug Hoffman RiseAbove", meta:"Bull",       vimeo:"https://vimeo.com/1162333865", catalogImg:"assets/img/Catalog/Lot 4.JPG" },
      { lot:"5",   name:"Bartelt Rise Above 558",   sire:"Stellpflug Hoffman RiseAbove", meta:"Bull",       vimeo:"https://vimeo.com/1162333914", catalogImg:"assets/img/Catalog/Lot 5.JPG" },
      { lot:"6",   name:"Bartelt Progressive 559",  sire:"Ellingson Profound 855",       meta:"Bull",       vimeo:"https://vimeo.com/1162334132", catalogImg:"assets/img/Catalog/Lot 6.JPG" },
      { lot:"7",   name:"Bartelt Progressive 561",  sire:"Ellingson Profound 855",       meta:"Bull",       vimeo:"https://vimeo.com/1162335921", catalogImg:"assets/img/Catalog/Lot 7.JPG" },
      { lot:"8",   name:"Bartelt Big Country 560",  sire:"Kraye Big Country 017",        meta:"Bull",       vimeo:"https://vimeo.com/1162334293", catalogImg:"assets/img/Catalog/Lot 8.JPG" },
      { lot:"9",   name:"Bartelt Statesman 555",    sire:"Virginia Tech Statesman",      meta:"Bull",       vimeo:"https://vimeo.com/1162334325", catalogImg:"assets/img/Catalog/Lot 9.JPG" },
      { lot:"10",  name:"Bartelt Bar None 556",     sire:"Deer Valley Growth Fund",      meta:"Commercial", vimeo:"https://vimeo.com/1162334352", catalogImg:"assets/img/Catalog/Lot 10.JPG" },
      { lot:"11",  name:"Bartelt Spectrum 571",     sire:"Sitz Spectrum",                meta:"Commercial", vimeo:"https://vimeo.com/1162334383", catalogImg:"assets/img/Catalog/Lot 11.JPG" },
      { lot:"12",  name:"Bartelt Bar None 572",     sire:"Deer Valley Growth Fund",      meta:"Commercial", vimeo:"https://vimeo.com/1162334426", catalogImg:"assets/img/Catalog/Lot 12.JPG" },
      { lot:"13",  name:"Bartelt Exclusive 573",    sire:"Mogck Exclusive 325",          meta:"Commercial", vimeo:"https://vimeo.com/1162334466", catalogImg:"assets/img/Catalog/Lot 13.JPG" },
      { lot:"14",  name:"A-B Palisades N552",       sire:"DJF Palisades 1170",           meta:"Bull",       vimeo:"https://vimeo.com/1162334539", catalogImg:"assets/img/Catalog/Lot 14.JPG" },
      { lot:"15",  name:"A-B Reserve N553",         sire:"LCDR Reserve 210J",            meta:"Bull",       vimeo:"https://vimeo.com/1162336799", catalogImg:"assets/img/Catalog/Lot 15.JPG" },
      { lot:"16A", name:"Bartelt Jilt 521",         sire:"Virginia Tech Statesman",      meta:"Heifer",     vimeo:"https://vimeo.com/1162334821", catalogImg:"assets/img/Catalog/Lot 16A.JPG" },
      { lot:"16B", name:"Bartelt Eileen Erica 522", sire:"Schiefelbein Top Gun 522",     meta:"Heifer",     vimeo:"https://vimeo.com/1162334880", catalogImg:"assets/img/Catalog/Lot 16B.JPG" },
      { lot:"16C", name:"Bartelt Erica 526",        sire:"Sitz Spectrum",                meta:"Heifer",     vimeo:"https://vimeo.com/1162334951", catalogImg:"assets/img/Catalog/Lot 16C.JPG" },
      { lot:"16D", name:"A-B Jilt N523",            sire:"KRJ Dakota Outlaw 6974",       meta:"Heifer",     vimeo:"https://vimeo.com/1162335034", catalogImg:"assets/img/Catalog/Lot 16D.JPG" },
    ];

    const grid = document.getElementById("grid");
    const searchInput = document.getElementById("searchInput");
    const countText = document.getElementById("countText");

    const playerTitle = document.getElementById("playerTitle");
    const playerSub = document.getElementById("playerSub");
    const playerFrame = document.getElementById("playerFrame");
    const catalogWrap = document.getElementById("catalogWrap");
    const catalogImg = document.getElementById("catalogImg");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const lotCounter = document.getElementById("lotCounter");

    // Scrub
    const scrub = document.getElementById("scrub");
    const timecode = document.getElementById("timecode");

    // Loading overlay
    const vimeoLoading = document.getElementById("vimeoLoading");
    const vimeoLoadingImg = document.getElementById("vimeoLoadingImg");

    // Modal elements
    const imgModal = document.getElementById("imgModal");
    const imgModalClose = document.getElementById("imgModalClose");
    const stage = document.getElementById("stage");
    const zoomImg = document.getElementById("zoomImg");

    let currentIndex = -1;

    // Vimeo player instance + timing
    let vPlayer = null;
    let duration = 0;
    let isScrubbing = false;

    async function initVimeoPlayerWith(item){
      if(!item || !item.vimeo) return;

      playerFrame.src = vimeoSrc(item.vimeo);
      vPlayer = new Vimeo.Player(playerFrame);

      try{
        await vPlayer.setMuted(true);
        await vPlayer.setVolume(0);
        await vPlayer.setLoop(true);
      }catch(e){}

      duration = await vPlayer.getDuration().catch(()=>0);
      if(!isFinite(duration) || duration < 0) duration = 0;

      timecode.textContent = `${fmtTime(0)} / ${fmtTime(duration)}`;
      scrub.value = 0;

      vPlayer.on("timeupdate", (data) => {
        const sec = (data && data.seconds) ? data.seconds : 0;

        if(!isScrubbing && duration > 0){
          const v = Math.max(0, Math.min(1000, Math.round((sec / duration) * 1000)));
          scrub.value = v;
        }
        timecode.textContent = `${fmtTime(sec)} / ${fmtTime(duration)}`;
      });

      vPlayer.on("ended", async () => {
        try{ await vPlayer.setCurrentTime(0); }catch(e){}
        try{ await vPlayer.play(); }catch(e){}
      });

      try{ await vPlayer.play(); }catch(e){}
    }

    async function playLot(item){
      if(!item || !item.vimeo) return;

      const id = extractVimeoId(item.vimeo);
      if(!id) return;

      // show quick thumb while switching
      vimeoLoadingImg.src = vimeoThumbUrl(id);
      vimeoLoading.style.display = "flex";

      try{
        if(!vPlayer){
          await initVimeoPlayerWith(item);
        }else{
          await vPlayer.loadVideo(id);
          await vPlayer.setMuted(true);
          await vPlayer.setVolume(0);
          await vPlayer.setLoop(true);
          await vPlayer.play();

          duration = await vPlayer.getDuration().catch(()=>0);
          if(!isFinite(duration) || duration < 0) duration = 0;
          timecode.textContent = `${fmtTime(0)} / ${fmtTime(duration)}`;
          scrub.value = 0;
        }
      }catch(e){
        // fallback: rebuild
        try{
          playerFrame.src = vimeoSrc(item.vimeo);
          vPlayer = new Vimeo.Player(playerFrame);
          await vPlayer.setMuted(true);
          await vPlayer.setLoop(true);
          await vPlayer.play();
        }catch(_){}
      }finally{
        setTimeout(()=>{ vimeoLoading.style.display = "none"; }, 220);
      }
    }

    function updateNav(){
      const total = lots.length;
      if(currentIndex < 0){
        lotCounter.textContent = "— / —";
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        return;
      }
      lotCounter.textContent = `${currentIndex + 1} / ${total}`;
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === total - 1;
    }

    async function selectLotByIndex(idx){
      const item = lots[idx];
      if(!item) return;

      currentIndex = idx;
      updateNav();

      document.querySelectorAll(".lot-card").forEach(c => c.classList.remove("active-lot"));
      const active = document.querySelector(`[data-lot="${item.lot}"]`);
      if(active) active.classList.add("active-lot");

      playerTitle.textContent = (item.name || `Lot ${item.lot}`).toUpperCase();
      playerSub.textContent = item.sire ? `SIRE: ${item.sire}`.toUpperCase() : "";

      if(item.vimeo && String(item.vimeo).trim() !== ""){
        await playLot(item); // ✅ autoplay + loop for every lot
      }else{
        playerFrame.src = "";
        if(vPlayer){ vPlayer.unload().catch(()=>{}); vPlayer = null; }
        duration = 0;
        timecode.textContent = "0:00 / 0:00";
        scrub.value = 0;
      }

      if(item.catalogImg && item.catalogImg.trim() !== ""){
        catalogImg.src = item.catalogImg.trim();
        catalogWrap.style.display = "flex";
      }else{
        catalogWrap.style.display = "none";
      }

      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function selectLotByLotId(lotId){
      const idx = lots.findIndex(x => String(x.lot) === String(lotId));
      if(idx >= 0) selectLotByIndex(idx);
    }

    function matchesSearch(item, q){
      if(!q) return true;
      const hay = `${item.lot} ${item.name} ${item.sire} ${item.meta}`.toLowerCase();
      return hay.includes(q);
    }

    function render(){
      const q = searchInput.value.trim().toLowerCase();
      const filtered = lots.filter(l => matchesSearch(l, q));
      countText.textContent = `${filtered.length} lot${filtered.length === 1 ? "" : "s"}`;

      grid.innerHTML = filtered.map(l => `
        <div class="col-12 col-md-6 col-lg-4">
          <div class="lot-card" data-lot="${l.lot}">
            <div class="lot-top">
              <div class="lot-left">
                <div>
                  <div class="lot-num">Lot</div>
                  <div class="lot-big">${l.lot}</div>
                </div>
                <div class="thumb" data-zoom="${l.catalogImg || ""}">
                  <img src="${l.catalogImg}" alt="Catalog preview for Lot ${l.lot}"
                       loading="lazy" decoding="async"
                       onerror="this.style.display='none'; this.parentElement.style.display='none';">
                </div>
              </div>
              <div class="play"><i class="fa-solid fa-play"></i></div>
            </div>
            <div class="lot-body">
              <p class="lot-title">${(l.name || l.lot)}</p>
              <p class="lot-meta">${l.meta || ""}</p>
            </div>
          </div>
        </div>
      `).join("");

      document.querySelectorAll(".lot-card").forEach(card => {
        card.addEventListener("click", () => {
          const lotId = card.getAttribute("data-lot");
          selectLotByLotId(lotId);
        });
      });

      document.querySelectorAll(".thumb").forEach(t => {
        t.addEventListener("click", (e) => {
          e.stopPropagation();
          const src = t.getAttribute("data-zoom");
          if(src) openImageModal(src);
        });
      });
    }

    // =========================
    // Scrub control (accurate)
    // =========================
    function scrubToTime(){
      if(!vPlayer || !duration) return;
      const ratio = parseInt(scrub.value, 10) / 1000;
      const target = Math.max(0, Math.min(duration, ratio * duration));
      vPlayer.setCurrentTime(target).catch(()=>{});
    }

    scrub.addEventListener("pointerdown", () => { isScrubbing = true; });
    scrub.addEventListener("pointerup", () => { isScrubbing = false; });

    scrub.addEventListener("input", () => {
      isScrubbing = true;
      scrubToTime();
    });

    scrub.addEventListener("change", () => {
      isScrubbing = false;
      scrubToTime();
    });

    // =========================
    // FULLSCREEN IMAGE MODAL
    // ✅ tap to enlarge ONLY; pinch to zoom
    // =========================
    let scale = 1;
    let minScale = 1;
    let maxScale = 4;
    let x = 0, y = 0;
    let isDragging = false;
    let startX = 0, startY = 0;
    let dragStartX = 0, dragStartY = 0;
    let lastTouchDist = null;

    function applyTransform(){
      zoomImg.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) scale(${scale})`;
    }
    function setCursor(){
      stage.style.cursor = (scale > minScale + 0.01) ? "grab" : "default";
    }

    function fitToScreen(){
      const rect = stage.getBoundingClientRect();
      const sw = rect.width;
      const sh = rect.height;

      const iw = zoomImg.naturalWidth || 1;
      const ih = zoomImg.naturalHeight || 1;

      const pad = 24;
      const fitW = Math.max(1, sw - pad * 2);
      const fitH = Math.max(1, sh - pad * 2);

      const fitScale = Math.min(fitW / iw, fitH / ih, 1);

      minScale = fitScale;
      scale = fitScale;
      x = 0; y = 0;

      setCursor();
      applyTransform();
      zoomImg.style.opacity = "1";
    }

    function openImageModal(src){
      imgModal.classList.add("show");
      imgModal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";

      zoomImg.style.opacity = "0";
      minScale = 1;
      scale = 1;
      x = 0; y = 0;
      setCursor();
      applyTransform();

      zoomImg.onload = () => { fitToScreen(); };
      zoomImg.src = src;

      setTimeout(() => { if(zoomImg.complete) fitToScreen(); }, 0);
    }

    function closeImageModal(){
      imgModal.classList.remove("show");
      imgModal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
      lastTouchDist = null;
      zoomImg.style.opacity = "0";
    }

    imgModal.addEventListener("click", (e) => {
      if(e.target === imgModal) closeImageModal();
    });
    imgModalClose.addEventListener("click", closeImageModal);

    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape" && imgModal.classList.contains("show")) closeImageModal();
    });

    // Drag only when zoomed in
    stage.addEventListener("pointerdown", (e) => {
      if(scale <= minScale + 0.01) return;
      e.preventDefault();
      stage.setPointerCapture(e.pointerId);
      isDragging = true;
      stage.classList.add("dragging");
      startX = e.clientX; startY = e.clientY;
      dragStartX = x; dragStartY = y;
    });

    stage.addEventListener("pointermove", (e) => {
      if(!isDragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      x = dragStartX + dx;
      y = dragStartY + dy;
      applyTransform();
    });

    stage.addEventListener("pointerup", () => {
      isDragging = false;
      stage.classList.remove("dragging");
    });

    stage.addEventListener("pointercancel", () => {
      isDragging = false;
      stage.classList.remove("dragging");
    });

    stage.addEventListener("wheel", (e) => {
      e.preventDefault();
      const delta = -Math.sign(e.deltaY) * 0.15;
      const next = Math.min(maxScale, Math.max(minScale, scale + delta));

      scale = next;
      if(scale <= minScale + 0.01){
        scale = minScale;
        x = 0; y = 0;
      }
      setCursor();
      applyTransform();
    }, { passive:false });

    stage.addEventListener("touchmove", (e) => {
      if(e.touches.length !== 2) { lastTouchDist = null; return; }
      e.preventDefault();

      const t1 = e.touches[0];
      const t2 = e.touches[1];
      const dx = t1.clientX - t2.clientX;
      const dy = t1.clientY - t2.clientY;
      const dist = Math.hypot(dx, dy);

      if(lastTouchDist == null){ lastTouchDist = dist; return; }

      const diff = (dist - lastTouchDist) / 250;
      scale = Math.min(maxScale, Math.max(minScale, scale + diff));
      lastTouchDist = dist;

      if(scale <= minScale + 0.01){
        scale = minScale;
        x = 0; y = 0;
      }
      setCursor();
      applyTransform();
    }, { passive:false });

    window.addEventListener("resize", () => {
      if(imgModal.classList.contains("show")) fitToScreen();
    });

    document.getElementById("catalogFrame").addEventListener("click", () => {
      const src = catalogImg.getAttribute("src");
      if(src) openImageModal(src);
    });

    // =========================
    // Init
    // =========================
    searchInput.addEventListener("input", render);

    prevBtn.addEventListener("click", () => {
      if(currentIndex > 0) selectLotByIndex(currentIndex - 1);
    });

    nextBtn.addEventListener("click", () => {
      if(currentIndex < lots.length - 1) selectLotByIndex(currentIndex + 1);
    });

    render();
    updateNav();
    selectLotByIndex(0); // ✅ autoplay first lot on load
  </script>

</body>
</html>
